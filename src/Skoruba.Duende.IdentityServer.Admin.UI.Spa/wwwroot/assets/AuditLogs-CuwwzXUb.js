import{j as e}from"./ui-vendor-B17-n605.js";import{a as m,R as w}from"./react-vendor-DPOhIiRq.js";import{c as b,a$ as S,ad as T,D as k,x as M,y as P,z as I,u as K,B as g,aY as z,aZ as E,a_ as F,Y as H,A as V,L as B,j as R}from"./index-DVaCOlPw.js";import{I as j}from"./input-BXtLITbC.js";import{P as U}from"./table-BGjshbTt.js";import{u as O}from"./usePaginationTable-07dZaguv.js";import{f as x}from"./utils-BBmT1Bs5.js";import{D as Y}from"./DataTable-CuhqpYks.js";import{C as $,a as q}from"./calendar-D3BrAClO.js";import{T as Q,a as X,b as y,c as v}from"./tabs-Brn-M21m.js";import{u as A}from"./i18n-vendor-TY_g4tCM.js";import{U as Z}from"./user-6Bxuf45g.js";import"./Card-DWFSUPWV.js";import"./table-vendor-Cc_vDqy9.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=b("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=b("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),J=async(t,a,l)=>{const n=new S(T.getApiBaseUrl()),r=t.created?x(new Date(t.created),"yyyy-MM-dd"):null,c=await n.auditLog(t.event??null,t.source??null,t.category??null,r,t.subjectIdentifier??null,t.subjectName??null,l,a);return{items:(c.logs??[]).map(s=>({id:s.id,event:s.event,source:s.source,category:s.category,subjectIdentifier:s.subjectIdentifier,subjectName:s.subjectName,subjectType:s.subjectType,subjectAdditionalData:s.subjectAdditionalData,action:s.action,data:s.data,created:s.created})),totalCount:c.totalCount}},W=({open:t,log:a,onClose:l,defaultTab:n="data"})=>{const{t:r}=A(),[c,s]=m.useState(n);return w.useEffect(()=>{t&&s(n)},[t,n,a==null?void 0:a.id]),e.jsx(k,{open:t,onOpenChange:i=>i?void 0:l(),children:e.jsxs(M,{onOpenAutoFocus:i=>i.preventDefault(),className:"overflow-auto max-w-[900px] max-h-[calc(100vh-2rem)]",children:[e.jsx(P,{children:e.jsx(I,{children:r("AuditLogs.DetailsModalTitle")})}),e.jsxs(Q,{value:c,onValueChange:i=>s(i),children:[e.jsxs(X,{className:"mb-4",children:[e.jsxs(y,{value:"data",className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),r("AuditLogs.Data")]}),e.jsxs(y,{value:"subject",className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),r("AuditLogs.SubjectAdditionalData")]})]}),e.jsx(v,{value:"data",children:a!=null&&a.data?e.jsx("pre",{className:"p-2 bg-gray-100 rounded text-sm overflow-x-auto",children:e.jsx("code",{children:a.data})}):e.jsx("p",{className:"text-muted-foreground",children:r("AuditLogs.NoData")})}),e.jsx(v,{value:"subject",children:a!=null&&a.subjectAdditionalData?e.jsx("pre",{className:"p-2 bg-muted rounded text-sm overflow-x-auto",children:e.jsx("code",{children:a.subjectAdditionalData})}):e.jsx("p",{className:"text-muted-foreground",children:r("AuditLogs.NoSubjectAdditionalData")})})]})]})})},xe=()=>{const{t}=A(),{pagination:a,setPagination:l}=O(),[n,r]=m.useState({}),[c,s]=m.useState(null),[i,p]=m.useState(),h={...n,created:i??void 0},{data:d,isLoading:f}=K([R.auditLogs,a,h],()=>J(h,a.pageIndex,a.pageSize),{keepPreviousData:!0}),u=(o,N)=>{r(C=>({...C,[o]:N}))},L=[{accessorKey:"event",header:t("AuditLogs.Event")},{accessorKey:"source",header:t("AuditLogs.Source")},{accessorKey:"subjectName",header:t("AuditLogs.SubjectName")},{accessorKey:"created",header:t("AuditLogs.Created"),cell:({row:o})=>x(new Date(o.original.created),"dd.MM.yyyy HH:mm:ss")},{id:"details",cell:({row:o})=>e.jsxs(g,{size:"sm",variant:"outline",onClick:()=>{s(o.original)},children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),t("AuditLogs.ViewDetails")]})}],D=e.jsxs("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-4 md:items-center",children:[e.jsx(j,{placeholder:t("AuditLogs.SearchEvent"),onChange:o=>u("event",o.target.value)}),e.jsx(j,{placeholder:t("AuditLogs.SearchSource"),onChange:o=>u("source",o.target.value)}),e.jsx(j,{placeholder:t("AuditLogs.SearchSubject"),onChange:o=>u("subjectName",o.target.value)}),e.jsxs("div",{className:"relative",children:[e.jsxs(z,{children:[e.jsx(E,{asChild:!0,children:e.jsxs(g,{variant:"outline",className:"w-full justify-start text-left font-normal pr-10",children:[e.jsx($,{className:"mr-2 h-4 w-4"}),i?x(i,"dd.MM.yyyy"):t("AuditLogs.SelectDate")]})}),e.jsx(F,{align:"start",className:"w-auto space-y-2 p-2",children:e.jsx(q,{mode:"single",selected:i,onSelect:o=>{p(o??void 0)},initialFocus:!0})})]}),i&&e.jsx("button",{className:"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",onClick:()=>{p(void 0),u("created",void 0)},"aria-label":t("AuditLogs.ClearDate"),children:e.jsx(H,{className:"h-4 w-4"})})]})]});return e.jsxs(U,{title:t("AuditLogs.PageTitle"),icon:V,accentKind:"monitoring",topSection:D,children:[f?e.jsx(B,{fullscreen:!0}):e.jsx(Y,{columns:L,data:(d==null?void 0:d.items)??[],totalCount:(d==null?void 0:d.totalCount)??0,pagination:a,setPagination:l}),e.jsx(W,{open:!!c,log:c,onClose:()=>s(null),defaultTab:"data"})]})};export{xe as default};
