import{j as e}from"./ui-vendor-B17-n605.js";import{k as h,a as f}from"./react-vendor-DPOhIiRq.js";import{z as a,u as _}from"./form-vendor-DdiMXTjA.js";import{a as r,t as P,F as w}from"./FormRow-DuEGuWVl.js";import{L,S as T,B as v,u as E,n as j,e as q,a7 as B,j as d,a6 as U,V as R}from"./index-Wlv9NPcq.js";import{u as k}from"./useMutation-D1x_VNBj.js";import{d as z,a as F,b as Q,D as K,c as M,e as V,u as W}from"./DeleteApiScopeDialog-2FOUhsmb.js";import{T as H,a as O,b as x,c as A}from"./tabs-CXZmsesD.js";import{C as g}from"./CardWrapper-CCnBsLvK.js";import{u as S,t as y,T as $}from"./i18n-vendor-TY_g4tCM.js";import{I as C}from"./info-gSZCZ4xF.js";import{p as G}from"./ClientServices-DObVnCYN.js";import{U as N}from"./user-B_drn4tR.js";import{P as J}from"./PropertiesApi-sYreriq6.js";import{T as X}from"./trash-2-DzGm9DQ5.js";import{T as Y}from"./Tip-O6tpldpu.js";import{H as Z}from"./Hoorey-C8E0EA7s.js";import{b as ee,a as se}from"./useConfirmUnsavedChanges-C4vNo6uX.js";import{P as ie}from"./table-BSc1Zwrq.js";import{B as ae}from"./Breadcrumbs-BRtvw2OO.js";import{u as oe}from"./modalHooks-CXBaxWb4.js";import{R as te}from"./ResourceConfigurationIssues-BhOGTk9v.js";const re=a.object({id:a.string(),label:a.string()}),ce=a.object({name:a.string(),displayName:a.string().optional(),description:a.string().optional(),enabled:a.boolean(),showInDiscoveryDocument:a.boolean(),required:a.boolean(),emphasize:a.boolean(),userClaims:a.array(re).optional()}),ne=s=>ce.extend({name:a.string().min(1,{message:s("Validation.FieldRequired",{field:s("ApiScope.Section.Label.Name_Label")})})}),Re={name:"",displayName:void 0,description:void 0,enabled:!0,showInDiscoveryDocument:!0,required:!1,emphasize:!1,userClaims:[]},pe=()=>{const{t:s}=S();return e.jsxs(g,{title:s("ApiScope.Tabs.Basics"),description:s("ApiScope.Tabs.BasicsDescription"),icon:C,children:[e.jsx(r,{name:"name",label:s("ApiScope.Section.Label.Name_Label"),description:s("ApiScope.Section.Label.Name_Info"),type:"input",required:!0}),e.jsx(r,{name:"displayName",label:s("ApiScope.Section.Label.DisplayName_Label"),description:s("ApiScope.Section.Label.DisplayName_Info"),type:"input"}),e.jsx(r,{name:"description",label:s("ApiScope.Section.Label.Description_Label"),description:s("ApiScope.Section.Label.Description_Info"),type:"textarea"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(r,{name:"enabled",label:s("ApiScope.Section.Label.Enabled_Label"),description:s("ApiScope.Section.Label.Enabled_Info"),type:"switch"}),e.jsx(r,{name:"showInDiscoveryDocument",label:s("ApiScope.Section.Label.ShowInDiscoveryDocument_Label"),description:s("ApiScope.Section.Label.ShowInDiscoveryDocument_Info"),type:"switch"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(r,{name:"required",label:s("ApiScope.Section.Label.Required_Label"),description:s("ApiScope.Section.Label.Required_Info"),type:"switch"}),e.jsx(r,{name:"emphasize",label:s("ApiScope.Section.Label.Emphasize_Label"),description:s("ApiScope.Section.Label.Emphasize_Info"),type:"switch"})]})]})},le=()=>{var o;const{t:s}=S(),i=G();return i.isLoading?e.jsx(L,{}):e.jsx(g,{title:s("ApiScope.Tabs.UserClaims"),description:s("ApiScope.Tabs.UserClaimsDescription"),icon:N,children:e.jsx(r,{name:"userClaims",label:s("ApiScope.Section.Label.UserClaims_Label"),description:s("ApiScope.Section.Label.UserClaims_Info"),type:"dualList",dualListSettings:{initialItems:((o=i.data)==null?void 0:o.map(c=>({id:c,label:c})))??[]}})})},me=()=>{const{scopeId:s}=h();return s?e.jsx(g,{title:y("ApiScope.Tabs.Properties"),description:y("ApiScope.Tabs.PropertiesDescription"),icon:T,children:e.jsx(J,{resourceId:Number(s),queryKey:["apiScopeProperties",s],pageTitle:"Properties",getProperties:Q,addProperty:F,deleteProperty:z})}):null},de=({apiScopeDelete:s})=>{const{t:i}=S(),{scopeId:o}=h();return e.jsxs(H,{defaultValue:"basics",className:"w-full",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs(O,{children:[e.jsxs(x,{value:"basics",className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4"}),i("ApiScope.Tabs.Basics")]}),e.jsxs(x,{value:"claims",className:"flex items-center gap-2",children:[e.jsx(N,{className:"h-4 w-4"}),i("ApiScope.Tabs.UserClaims")]}),o&&e.jsxs(x,{value:"properties",className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),i("ApiScope.Tabs.Properties")]})]}),e.jsx("div",{className:"inline-flex",children:s&&e.jsxs(v,{variant:"destructive",onClick:s,type:"button",children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),i("ApiScope.Actions.Delete")]})})]}),e.jsx(A,{value:"basics",children:e.jsx(pe,{})}),e.jsx(A,{value:"claims",children:e.jsx(le,{})}),o&&e.jsx(A,{value:"properties",children:e.jsx(me,{})})]})};var u=(s=>(s.Create="create",s.Edit="edit",s))(u||{});const ue=()=>{const{t:s}=S(),{scopeId:i}=h(),o=oe(),[c,l]=f.useState(()=>()=>{}),{data:t,isLoading:p}=E([d.apiScope,i],()=>M(Number(i))),n=f.useCallback(()=>{c(j)},[c]),m=f.useCallback(()=>{o.openModal()},[o]);return p||!t?e.jsx(L,{fullscreen:!0}):e.jsxs(ie,{title:s("ApiScope.Edit.PageTitle"),icon:q,accentKind:"management",breadcrumb:e.jsx(ae,{items:[{url:j,name:s("ApiScopes.PageTitle")},{name:t.name}]}),children:[e.jsx(K,{apiScopeId:Number(i),apiScopeName:t.name,modal:o,onApiScopeDeleted:n}),e.jsx(te,{resourceId:Number(i),resourceType:B.ApiScope}),e.jsx(Se,{mode:"edit",scopeId:i,defaultValues:t,apiScopeDelete:m,setNavigateWithBlocker:l})]})},ke=Object.freeze(Object.defineProperty({__proto__:null,ApiScopeFormMode:u,default:ue},Symbol.toStringTag,{value:"Module"})),Se=({mode:s,scopeId:i,defaultValues:o,apiScopeDelete:c,setNavigateWithBlocker:l})=>{const{t}=S(),p=U(),n=_({resolver:P(ne(t)),defaultValues:o}),m=ee(n);f.useEffect(()=>{l&&l(()=>m)},[m,l]);const{DialogCmp:D}=se(n.formState.isDirty),I=k(b=>s===u.Create?V(b):W(Number(i),b),{onSuccess:()=>{p.invalidateQueries(d.apiScope),p.invalidateQueries(d.apiScopes),p.invalidateQueries(d.configurationIssues),p.invalidateQueries(d.configurationIssuesSummary),R({title:e.jsx(Z,{}),description:s===u.Create?t("ApiScope.Actions.Created"):t("ApiScope.Actions.Updated")}),m(j)}});return e.jsxs(e.Fragment,{children:[e.jsx(w,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(b=>I.mutate(b)),children:[e.jsx(Y,{className:"mb-3",children:e.jsx($,{i18nKey:"ApiScope.Tips.ApiScopeAssigned",values:{apiScopeName:n.watch("name")},components:{strong:e.jsx("strong",{})}})}),e.jsx(de,{apiScopeDelete:c}),e.jsx("div",{className:"flex gap-4 justify-start mt-4",children:e.jsx(v,{type:"submit",children:s===u.Create?t("Actions.Create"):t("Actions.Save")})})]})}),D]})};export{Se as A,u as a,ke as b,Re as d};
